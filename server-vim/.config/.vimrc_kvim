" ============================================= 一、插件设置 =============================================

" =============================================
" 1.老板设置：\w 等价 :w
" =============================================

let mapleader = ','
let g:mapleader = ','


" =============================================
" 2.语法高亮：开启
" =============================================

syntax on


" =============================================
" 3.插件设置
" =============================================

set nocompatible
filetype off
" call plug#begin('~/.vim/plugged')

" Plug 'morhetz/gruvbox'

" call plug#end()
filetype plugin indent on


" ============================================= 二、文件类型 =============================================

" =============================================
" 1.一般配置：python、ruby、markdown、.sh、.py、...
" =============================================

autocmd FileType python set tabstop=4 shiftwidth=4 expandtab ai
autocmd FileType ruby,javascript,html,css,xml set tabstop=2 shiftwidth=2 softtabstop=2 expandtab ai
autocmd BufRead,BufNewFile *.md,*.mkd,*.markdown set filetype=markdown.mkd
autocmd BufRead,BufNewFile *.part set filetype=html
autocmd BufRead,BufNewFile *.vue setlocal filetype=vue.html.javascript tabstop=2 shiftwidth=2 softtabstop=2 expandtab ai
au BufWinEnter *.php set mps-=<:>


" =============================================
" 2.移除空格：自动移除多余空格
" =============================================

fun! <SID>StripTrailingWhitespaces()
    let l = line(" ." )
    let c = col(" ." )
    %s/\s\+$//e
    call cursor(l, c)
endfun
autocmd FileType c,cpp,java,go,php,javascript,puppet,python,rust,twig,xml,yml,perl autocmd BufWritePre <buffer> :call <SID>StripTrailingWhitespaces()


" =============================================
" 3.创建文件：自动插入文件头
" =============================================
autocmd BufNewFile *.sh,*.py exec " :call AutoSetFileHead()"
function! AutoSetFileHead()
    if &filetype == 'sh'
        call setline(1, " \#!/bin/bash" )
    endif
    if &filetype == 'python'
        " call setline(1, " \#!/usr/bin/env python" )
        " call append(1, " \# encoding: utf-8" )
        call setline(1, " \# -*- coding: utf-8 -*-" )
    endif
    normal G
    normal o
    normal o
endfunc


" =============================================
" 4.自定高亮：自定义一些高亮关键字
" =============================================

if has(" autocmd" )
  " Highlight TODO, FIXME, NOTE, etc.
  if v:version > 701
    autocmd Syntax * call matchadd('Todo',  '\W\zs\(TODO\|FIXME\|CHANGED\|DONE\|XXX\|BUG\|HACK\)')
    autocmd Syntax * call matchadd('Debug', '\W\zs\(NOTE\|INFO\|IDEA\|NOTICE\)')
  endif
endif


" =============================================
" 5.代码折叠：根据代码文件格式折叠
" =============================================

set foldenable

set foldmethod=indent
set foldlevel=99

let g:FoldMethod = 0
map <leader>zz :call ToggleFold()<cr>
fun! ToggleFold()
    if g:FoldMethod == 0
        exe " normal! zM"
        let g:FoldMethod = 1
    else
        exe " normal! zR"
        let g:FoldMethod = 0
    endif
endfun


" =============================================
" 6.不切行首：py文件中输入新行时#号注释不切回行首
" =============================================

autocmd BufNewFile,BufRead *.py inoremap # X<c-h>#


" =============================================
" 7.缓冲信息：关闭时记住缓冲区信息，viminfo用户可写
" =============================================

set viminfo^=%


" =============================================
" 8.缓冲信息：当一个缓冲区被遗弃时，它就会被隐藏起来
" =============================================

set hidden
set wildmode=list:longest
set ttyfast


" =============================================
" 9.编辑位置：光标移至最后编辑位置，viminfo用户可写
" =============================================

if has(" autocmd" )
  au BufReadPost * if line(" '\" " ) > 1 && line(" '\" " ) <= line(" $" ) | exe " normal! g'\" " | endif
endif


" ============================================= 三、系统设置 =============================================

" =============================================
" 1.主题设置
" =============================================

if has(" gui_running" )
    set guifont=Monaco:h14
    if has(" gui_gtk2" )   " GTK2
        set guifont=Monaco\ 12,Monospace\ 12
    endif
    set guioptions-=T
    set guioptions+=e
    set guioptions-=r
    set guioptions-=L
    set guitablabel=%M\ %t
    set showtabline=1
    set linespace=2
    set noimd
    set t_Co=256
endif

set background=dark

colorscheme desert

hi! link SignColumn   LineNr
hi! link ShowMarksHLl DiffAdd
hi! link ShowMarksHLu DiffChange

highlight clear SpellBad
highlight SpellBad term=standout ctermfg=1 term=underline cterm=underline
highlight clear SpellCap
highlight SpellCap term=underline cterm=underline
highlight clear SpellRare
highlight SpellRare term=underline cterm=underline
highlight clear SpellLocal
highlight SpellLocal term=underline cterm=underline

if &term =~ '256color'
  " disable Background Color Erase (BCE) so that color schemes
  " render properly when inside 256-color tmux and GNU screen.
  " see also http://snk.tuxfamily.org/log/vim-256color-bce.html
  set t_ut=
endif


" =============================================
" 2.鼠标操作
" =============================================

set mouse=a

" set mouse-=a

set selection=inclusive
set selectmode=mouse,key


" =============================================
" 3.行尾空格
" =============================================

set listchars=tab:>-,trail:.,precedes:<,extends:>

set list


" =============================================
" 4.TAB补全
" =============================================

set wildmenu

set wildmode=longest:list,full


" =============================================
" 5.窗口标题 / 当前模式 / 当前命令 / 历史条数
" =============================================

set title

set showcmd

set showmode

set history=1000


" =============================================
" 6.援助提示 / 正则字符 / 出错提示 / 误删恢复
" =============================================

set shortmess=atI

set magic

set autoread

set novisualbell
set novisualbell
set noerrorbells
set t_vb=
set tm=500

set t_ti= t_te=


" ============================================= 四、常见设置 =============================================

" =============================================
" 1.备份文件、交换文件、操作历史
" =============================================

set nobackup

set noswapfile

set noundofile

set backupdir=~/.vim/.backup/

set directory=~/.vim/.swp/

set undodir=~/.vim/.undo/


" =============================================
" 2.编码设置
" =============================================

set encoding=utf-8

set fileencodings=ucs-bom,utf-8,cp936,gb18030,big5,euc-jp,euc-kr,latin1

set termencoding=utf-8

set fileformats=unix,dos,mac

set formatoptions+=m

set formatoptions+=B


" =============================================
" 3.搜索结果
" =============================================

set showmatch
set matchtime=2

set hlsearch

set incsearch

set ignorecase

set smartcase


" =============================================
" 4.缩进设置
" =============================================

set expandtab

set smarttab

set shiftround

set autoindent

set smartindent

set shiftwidth=2

set tabstop=2

set softtabstop=2


" =============================================
" 5.行号设置
" =============================================

set cursorline

set cursorcolumn

set nowrap

" set textwidth=120

set linebreak

set wrapmargin=2

set scrolloff=7

set sidescrolloff=15

set ruler

set statusline=%<%f\ %h%m%r%=%k[%{(&fenc==\"\")?&enc:&fenc}%{(&bomb?\",BOM\":\"\")}]\ %-14.(%l,%c%V%)\ %P
set laststatus=2

set relativenumber number
au FocusLost * :set norelativenumber number
au FocusGained * :set relativenumber

autocmd InsertEnter * :set norelativenumber number
autocmd InsertLeave * :set relativenumber
function! NumberToggle()
  if(&relativenumber == 1)
    set norelativenumber number
  else
    set relativenumber
  endif
endfunc
nnoremap <C-n> :call NumberToggle()<cr>


" ============================================= 五、键盘映射 =============================================

" =============================================
" 1.常见设置
" =============================================

inoremap kj <Esc>

nnoremap <leader>q :q<CR>

nnoremap <leader>w :w<CR>

cmap w!! w !sudo tee >/dev/null %

autocmd! bufwritepost .vimrc source %

map <C-S> :w<CR>

autocmd InsertLeave * if pumvisible() == 0|pclose|endif


" =============================================
" 2.Fn 设置
" =============================================

noremap <F1> <Esc>"

function! HideNumber()
  if(&relativenumber == &number)
    set relativenumber! number!
  elseif(&number)
    set number!
  else
    set relativenumber!
  endif
  set number?
endfunc
nnoremap <F2> :call HideNumber()<CR>

nnoremap <F3> :set list! list?<CR>

nnoremap <F4> :set wrap! wrap?<CR>

set pastetoggle=<F5>

nnoremap <F6> :exec exists('syntax_on') ? 'syn off' : 'syn on'<CR>

au InsertLeave * set nopaste

function! XTermPasteBegin()
  set pastetoggle=<Esc>[201~
  set paste
  return " "
endfunction
inoremap <special> <expr> <Esc>[200~ XTermPasteBegin()


" =============================================
" 3.方向控制
" =============================================

nnoremap <Up> :echomsg " Use k" <cr>
nnoremap <Down> :echomsg " Use j" <cr>
nnoremap <Left> :echomsg " Use h" <cr>
nnoremap <Right> :echomsg " Use l" <cr>

nnoremap k gk
nnoremap gk k
nnoremap j gj
nnoremap gj j

nnoremap <C-e> 2<C-e>
nnoremap <C-y> 2<C-y>

" nnoremap [b :bprevious<cr>
" nnoremap ]b :bnext<cr>

" noremap <left> :bp<CR>
" noremap <right> :bn<CR>

" inoremap <expr> <Down>     pumvisible() ? " \<C-n>" : " \<Down>"
" inoremap <expr> <Up>       pumvisible() ? " \<C-p>" : " \<Up>"
" inoremap <expr> <PageDown> pumvisible() ? " \<PageDown>\<C-p>\<C-n>" : " \<PageDown>"
" inoremap <expr> <PageUp>   pumvisible() ? " \<PageUp>\<C-p>\<C-n>" : " \<PageUp>"


" =============================================
" 4.搜索操作
" =============================================

noremap <silent><leader>/ :nohls<CR>

nnoremap <silent> n nzz
nnoremap <silent> N Nzz
nnoremap <silent> * *zz
nnoremap <silent> # #zz
nnoremap <silent> g* g*zz

nnoremap gv `[v`]


" =============================================
" 5.多行缩进 / 本行光标 / 全文光标 / 空格搜索
" =============================================

vnoremap < <gv
vnoremap > >gv

nnoremap H ^
nnoremap L $

cnoremap <C-j> <t_kd>
cnoremap <C-k> <t_ku>
cnoremap <C-a> <Home>
cnoremap <C-e> <End>

map <space> /

nnoremap / /\v
vnoremap / /\v


" =============================================
" 6.复制操作 / 撤销操作 / 选中操作 / 调换键位
" =============================================

map Y y$

vnoremap <leader>y " +y

nnoremap U <C-r>

map <Leader>sa ggVG

nnoremap <leader>v V`}

nnoremap ' `
nnoremap ` '
nnoremap ; :
nnoremap : ;
nnoremap # *
nnoremap * #


" ============================================= 六、多窗操作 =============================================

" =============================================
" 1.多窗模式
" =============================================

map <C-j> <C-W>j
map <C-k> <C-W>k
map <C-h> <C-W>h
map <C-l> <C-W>l

set autochdir

function! s:ZoomToggle() abort
    if exists('t:zoomed') && t:zoomed
        execute t:zoom_winrestcmd
        let t:zoomed = 0
    else
        let t:zoom_winrestcmd = winrestcmd()
        resize
        vertical resize
        let t:zoomed = 1
    endif
endfunction
command! ZoomToggle call s:ZoomToggle()
nnoremap <silent> <Leader>z :ZoomToggle<CR>


" =============================================
" 2.标签切换
" =============================================

map <leader>th :tabfirst<cr>
map <leader>tl :tablast<cr>
map <leader>tj :tabnext<cr>
map <leader>tk :tabprev<cr>
map <leader>tn :tabnext<cr>
map <leader>tp :tabprev<cr>
map <leader>te :tabedit<cr>
map <leader>td :tabclose<cr>
map <leader>tm :tabm<cr>


" =============================================
" 3.准确切换
" =============================================

noremap <leader>1 1gt
noremap <leader>2 2gt
noremap <leader>3 3gt
noremap <leader>4 4gt
noremap <leader>5 5gt
noremap <leader>6 6gt
noremap <leader>7 7gt
noremap <leader>8 8gt
noremap <leader>9 9gt
noremap <leader>0 :tablast<cr>


" =============================================
" 4.标签配置
" =============================================

" Toggles between the active and last active tab "
" The first tab is always 1 "
let g:last_active_tab = 1
" nnoremap <leader>gt :execute 'tabnext ' . g:last_active_tab<cr>
" nnoremap <silent> <c-o> :execute 'tabnext ' . g:last_active_tab<cr>
" vnoremap <silent> <c-o> :execute 'tabnext ' . g:last_active_tab<cr>
nnoremap <silent> <leader>tt :execute 'tabnext ' . g:last_active_tab<cr>
autocmd TabLeave * let g:last_active_tab = tabpagenr()


" =============================================
" 5.新建标签
" =============================================

nnoremap <C-t>     :tabnew<CR>
inoremap <C-t>     <Esc>:tabnew<CR>
